{"ast":null,"code":"import { FormBuilder, FormControl, Validators } from '@angular/forms';\nimport { dataExample } from 'app/helpers/formData';\nimport { successAlert } from 'app/helpers/sweetalert';\nimport { CommunitiesService } from 'app/services/communities.service';\nimport { DepartmentService } from 'app/services/department.service';\nimport { MunicipalitiesService } from 'app/services/municipalities.service';\nimport { PollService } from 'app/services/poll.service';\nimport { QuestionService } from 'app/services/question.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/services/department.service\";\nimport * as i2 from \"app/services/municipalities.service\";\nimport * as i3 from \"app/services/communities.service\";\nimport * as i4 from \"app/services/question.service\";\nimport * as i5 from \"app/services/poll.service\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/common\";\nfunction MonitoringComponent_option_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r6 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", item_r6.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r6.nameD, \" \");\n  }\n}\nfunction MonitoringComponent_option_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r7 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", item_r7.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r7.nameM, \" \");\n  }\n}\nfunction MonitoringComponent_option_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r8 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", item_r8.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r8.nameC);\n  }\n}\nfunction MonitoringComponent_p_59_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Loading\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MonitoringComponent_form_60_div_3_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33)(1, \"fieldset\")(2, \"div\", 10)(3, \"div\", 33);\n    i0.ɵɵelement(4, \"textarea\", 34);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const item_r10 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formControlName\", item_r10.key2);\n  }\n}\nfunction MonitoringComponent_form_60_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"label\", 28);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 29)(4, \"label\", 30);\n    i0.ɵɵelement(5, \"input\", 31);\n    i0.ɵɵtext(6, \"SI \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\", 30);\n    i0.ɵɵelement(8, \"input\", 31);\n    i0.ɵɵtext(9, \"NO \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(10, MonitoringComponent_form_60_div_3_div_10_Template, 5, 1, \"div\", 32);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r10 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r10.descripcion, \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"name\", item_r10.key);\n    i0.ɵɵpropertyInterpolate(\"id\", item_r10.key);\n    i0.ɵɵproperty(\"formControlName\", item_r10.key)(\"value\", true);\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"name\", item_r10.key);\n    i0.ɵɵpropertyInterpolate(\"id\", item_r10.key);\n    i0.ɵɵproperty(\"formControlName\", item_r10.key)(\"value\", false);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", item_r10.recommendation);\n  }\n}\nfunction MonitoringComponent_form_60_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 26);\n    i0.ɵɵlistener(\"ngSubmit\", function MonitoringComponent_form_60_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.save());\n    });\n    i0.ɵɵelementStart(1, \"legend\");\n    i0.ɵɵtext(2, \"Monitoreo de Organizaciones Locales\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, MonitoringComponent_form_60_div_3_Template, 11, 10, \"div\", 27);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r4.formPoll);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.dataGroup);\n  }\n}\nfunction MonitoringComponent_fieldset_61_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"fieldset\")(1, \"div\", 35)(2, \"button\", 36, 37);\n    i0.ɵɵlistener(\"click\", function MonitoringComponent_fieldset_61_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.save());\n    });\n    i0.ɵɵtext(4, \"Guardar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r5.formPoll.invalid);\n  }\n}\nexport let MonitoringComponent = /*#__PURE__*/(() => {\n  class MonitoringComponent {\n    deparmentService;\n    municipalitiesService;\n    communitiesService;\n    questionsService;\n    pollservice;\n    formBuilder;\n    departments = [];\n    municipalities = [];\n    communities = [];\n    question = [];\n    dateMonitory = \"\";\n    dataGroup = [];\n    loadingQuestions = true;\n    generalRecommendation = \"\";\n    formPoll;\n    communityId = 0;\n    municipalityId = 0;\n    departmentId = 0;\n    constructor(deparmentService, municipalitiesService, communitiesService, questionsService, pollservice, formBuilder) {\n      this.deparmentService = deparmentService;\n      this.municipalitiesService = municipalitiesService;\n      this.communitiesService = communitiesService;\n      this.questionsService = questionsService;\n      this.pollservice = pollservice;\n      this.formBuilder = formBuilder;\n    }\n    ngOnInit() {\n      //this.inicialiceTable();\n      this.dataGroup = dataExample;\n      this.getDeparments();\n      this.getQuestions();\n    }\n    /*\r\n        inicialiceTable() {\r\n            //  Activate the tooltips\r\n            $('[rel=\"tooltip\"]').tooltip();\r\n    \r\n            //  Init Bootstrap Select Picker\r\n            if ($(\".selectpicker\").length != 0) {\r\n                $(\".selectpicker\").selectpicker({\r\n                    iconBase: \"fa\",\r\n                    tickIcon: \"fa-check\"\r\n                });\r\n            }\r\n    \r\n            $('.datetimepicker').datetimepicker({\r\n                icons: {\r\n                    time: \"fa fa-clock-o\",\r\n                    date: \"fa fa-calendar\",\r\n                    up: \"fa fa-chevron-up\",\r\n                    down: \"fa fa-chevron-down\",\r\n                    previous: 'fa fa-chevron-left',\r\n                    next: 'fa fa-chevron-right',\r\n                    today: 'fa fa-screenshot',\r\n                    clear: 'fa fa-trash',\r\n                    close: 'fa fa-remove'\r\n                }\r\n            });\r\n    \r\n            $('.datepicker').datetimepicker({\r\n                format: 'MM/DD/YYYY',    //use this format if you want the 12hours timpiecker with AM/PM toggle\r\n                icons: {\r\n                    time: \"fa fa-clock-o\",\r\n                    date: \"fa fa-calendar\",\r\n                    up: \"fa fa-chevron-up\",\r\n                    down: \"fa fa-chevron-down\",\r\n                    previous: 'fa fa-chevron-left',\r\n                    next: 'fa fa-chevron-right',\r\n                    today: 'fa fa-screenshot',\r\n                    clear: 'fa fa-trash',\r\n                    close: 'fa fa-remove'\r\n                }\r\n            });\r\n    \r\n            $('.timepicker').datetimepicker({\r\n                //          format: 'H:mm',    // use this format if you want the 24hours timepicker\r\n                format: 'h:mm A',    //use this format if you want the 12hours timpiecker with AM/PM toggle\r\n                icons: {\r\n                    time: \"fa fa-clock-o\",\r\n                    date: \"fa fa-calendar\",\r\n                    up: \"fa fa-chevron-up\",\r\n                    down: \"fa fa-chevron-down\",\r\n                    previous: 'fa fa-chevron-left',\r\n                    next: 'fa fa-chevron-right',\r\n                    today: 'fa fa-screenshot',\r\n                    clear: 'fa fa-trash',\r\n                    close: 'fa fa-remove'\r\n                }\r\n    \r\n            });\r\n        }\r\n    */\n    getDeparments() {\n      this.deparmentService.getAll().subscribe(res => {\n        //console.log(res);\n        this.departments = res.data;\n      });\n    }\n    getMunicipalitiesByDeparment(event) {\n      let departmentId = event.target.value;\n      this.communities = [];\n      this.municipalities = [];\n      this.departmentId = Number(departmentId);\n      this.municipalitiesService.getByDepartmentId(departmentId).subscribe(res => {\n        this.municipalities = res.data;\n      });\n    }\n    getMunicipalities(event) {\n      let municipalityId = event.target.value;\n      this.municipalityId = Number(municipalityId);\n      this.communitiesService.getByCommunityByMunicipalityId(municipalityId).subscribe(res => {\n        this.communities = res.data;\n      });\n    }\n    getQuestions() {\n      this.questionsService.getAll().subscribe(res => {\n        this.question = res.data;\n        let data = [];\n        let group = {};\n        res.data.forEach(item => {\n          data.push({\n            questionId: item.id,\n            descripcion: item.description,\n            otherResponse: \"\",\n            recommendation: item.recommendation,\n            key: \"questions?\" + item.id,\n            key2: \"recommendations?\" + item.id\n          });\n        });\n        this.dataGroup = data;\n        data.forEach(question => {\n          group[question.key] = new FormControl(false, Validators.required);\n          if (question?.key2) {\n            group[question.key2] = new FormControl(\"\", question.recommendation && Validators.required);\n          }\n        });\n        this.formPoll = this.formBuilder.group(group);\n        this.loadingQuestions = false;\n      });\n    }\n    save() {\n      //console.log({ municipalityId: this.municipalityId, departmentId: this.departmentId, communityId: Number(this.communityId) });\n      let req = [];\n      this.dataGroup.forEach(element => {\n        let questionId = Number(element.key.split('?')[1]);\n        req.push({\n          description: this.formPoll.get(element.key2).value,\n          response: this.formPoll.get(element.key).value,\n          QuestionId: questionId,\n          CommunityId: Number(this.communityId)\n        });\n      });\n      let body = {\n        polls: req,\n        survey: {\n          recomendation: this.generalRecommendation,\n          monitoringDate: '',\n          communityId: Number(this.communityId)\n        }\n      };\n      console.log(body);\n      this.pollservice.bulkCreate(body).subscribe(data => console.log(data));\n      successAlert('Exitoso', 'Registro guardado con exito');\n    }\n    inicializeProperteForm() {\n      let data = [];\n      this.question.forEach(item => {\n        data.push({\n          questionId: item.id,\n          descripcion: item.description,\n          otherResponse: \"\",\n          recommendation: item.recommendation,\n          key: \"questions?\" + item.id,\n          key2: \"recommendations?\" + item.id\n        });\n      });\n      this.dataGroup = [...data];\n    }\n    toFormGroup() {\n      const group = {};\n      this.dataGroup.forEach(question => {\n        group[question.key] = new FormControl(false, Validators.required);\n        if (question?.key2) {\n          group[question.key2] = new FormControl(\"\", Validators.required);\n        }\n      });\n      this.formPoll = this.formBuilder.group(group);\n    }\n    static ɵfac = function MonitoringComponent_Factory(t) {\n      return new (t || MonitoringComponent)(i0.ɵɵdirectiveInject(i1.DepartmentService), i0.ɵɵdirectiveInject(i2.MunicipalitiesService), i0.ɵɵdirectiveInject(i3.CommunitiesService), i0.ɵɵdirectiveInject(i4.QuestionService), i0.ɵɵdirectiveInject(i5.PollService), i0.ɵɵdirectiveInject(i6.FormBuilder));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MonitoringComponent,\n      selectors: [[\"app-monitoring\"]],\n      decls: 64,\n      vars: 9,\n      consts: [[1, \"main-content\"], [1, \"content\"], [1, \"row\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"header\"], [1, \"title\"], [1, \"category\"], [1, \"card-0\"], [1, \"form-horizontal\"], [1, \"form-group\"], [1, \"col-sm-2\", \"control-label\", 2, \"text-align\", \"left\"], [1, \"col-sm-10\"], [\"type\", \"date\", \"placeholder\", \"Fecha Monitoreo\", 1, \"form-control\", \"datetimepicker\", 3, \"ngModel\", \"ngModelChange\"], [\"placeholder\", \"Departamento\", 1, \"form-control\", 3, \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"id\", \"municipio\", \"placeholder\", \"municipio\", 1, \"form-control\", 3, \"change\"], [\"id\", \"comunidad\", \"placeholder\", \"comunidad\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"0\"], [\"rows\", \"6\", \"placeholder\", \"Ingrese su recomendacione general\", 1, \"form-control\", \"valid\", 3, \"ngModel\", \"ngModelChange\"], [4, \"ngIf\"], [3, \"formGroup\", \"ngSubmit\", 4, \"ngIf\"], [1, \"col-md-6\", \"col-md-offset-1\"], [\"id\", \"worldMap\", 2, \"height\", \"300px\"], [3, \"value\"], [3, \"formGroup\", \"ngSubmit\"], [\"class\", \"form-group\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-sm-10\", \"control-label\", 2, \"text-align\", \"left\"], [1, \"col-sm-2\"], [1, \"radio-inline\"], [\"type\", \"radio\", 3, \"formControlName\", \"name\", \"id\", \"value\"], [\"class\", \"col-sm-12\", 4, \"ngIf\"], [1, \"col-sm-12\"], [\"rows\", \"6\", \"placeholder\", \"Ingrese sus recomendaciones\", 1, \"form-control\", \"valid\", 3, \"formControlName\"], [1, \"center-btn\"], [1, \"btn\", \"btn-success\", \"btn-fill\", \"btn-wd\", 3, \"disabled\", \"click\"], [\"btnSave\", \"\"]],\n      template: function MonitoringComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5)(6, \"h4\", 6);\n          i0.ɵɵtext(7, \"Ficha de Monitoreo de Organizaciones Locales\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(8, \"p\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"div\", 1)(10, \"div\", 2)(11, \"div\", 3)(12, \"div\", 3)(13, \"div\", 8)(14, \"div\", 5)(15, \"legend\");\n          i0.ɵɵtext(16, \"Datos Generales\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(17, \"div\", 1)(18, \"div\", 9)(19, \"fieldset\")(20, \"div\", 10)(21, \"label\", 11);\n          i0.ɵɵtext(22, \"Fecha Monitoreo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"div\", 12)(24, \"input\", 13);\n          i0.ɵɵlistener(\"ngModelChange\", function MonitoringComponent_Template_input_ngModelChange_24_listener($event) {\n            return ctx.dateMonitory = $event;\n          });\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(25, \"fieldset\")(26, \"div\", 10)(27, \"label\", 11);\n          i0.ɵɵtext(28, \"Departamento\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"div\", 12)(30, \"select\", 14);\n          i0.ɵɵlistener(\"change\", function MonitoringComponent_Template_select_change_30_listener($event) {\n            return ctx.getMunicipalitiesByDeparment($event);\n          });\n          i0.ɵɵelementStart(31, \"option\", 15);\n          i0.ɵɵtext(32, \"Seleccione un Departamento\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(33, MonitoringComponent_option_33_Template, 2, 2, \"option\", 16);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(34, \"fieldset\")(35, \"div\", 10)(36, \"label\", 11);\n          i0.ɵɵtext(37, \"Municipio\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(38, \"div\", 12)(39, \"select\", 17);\n          i0.ɵɵlistener(\"change\", function MonitoringComponent_Template_select_change_39_listener($event) {\n            return ctx.getMunicipalities($event);\n          });\n          i0.ɵɵelementStart(40, \"option\", 15);\n          i0.ɵɵtext(41, \"Seleccione un Municipio\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(42, MonitoringComponent_option_42_Template, 2, 2, \"option\", 16);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(43, \"fieldset\")(44, \"div\", 10)(45, \"label\", 11);\n          i0.ɵɵtext(46, \"Comunidad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(47, \"div\", 12)(48, \"select\", 18);\n          i0.ɵɵlistener(\"ngModelChange\", function MonitoringComponent_Template_select_ngModelChange_48_listener($event) {\n            return ctx.communityId = $event;\n          });\n          i0.ɵɵelementStart(49, \"option\", 19);\n          i0.ɵɵtext(50, \"Seleccione un Comunidad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(51, MonitoringComponent_option_51_Template, 2, 2, \"option\", 16);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(52, \"fieldset\")(53, \"div\", 10)(54, \"label\", 11);\n          i0.ɵɵtext(55, \"Recomendacion general\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(56, \"div\", 12)(57, \"textarea\", 20);\n          i0.ɵɵlistener(\"ngModelChange\", function MonitoringComponent_Template_textarea_ngModelChange_57_listener($event) {\n            return ctx.generalRecommendation = $event;\n          });\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelement(58, \"br\");\n          i0.ɵɵtemplate(59, MonitoringComponent_p_59_Template, 2, 0, \"p\", 21);\n          i0.ɵɵtemplate(60, MonitoringComponent_form_60_Template, 4, 2, \"form\", 22);\n          i0.ɵɵtemplate(61, MonitoringComponent_fieldset_61_Template, 5, 1, \"fieldset\", 21);\n          i0.ɵɵelementEnd()()()()();\n          i0.ɵɵelementStart(62, \"div\", 23);\n          i0.ɵɵelement(63, \"div\", 24);\n          i0.ɵɵelementEnd()()()()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(24);\n          i0.ɵɵproperty(\"ngModel\", ctx.dateMonitory);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngForOf\", ctx.departments);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngForOf\", ctx.municipalities);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngModel\", ctx.communityId);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.communities);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngModel\", ctx.generalRecommendation);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.loadingQuestions);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.loadingQuestions);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.loadingQuestions);\n        }\n      },\n      dependencies: [i7.NgForOf, i7.NgIf, i6.ɵNgNoValidate, i6.NgSelectOption, i6.ɵNgSelectMultipleOption, i6.DefaultValueAccessor, i6.SelectControlValueAccessor, i6.RadioControlValueAccessor, i6.NgControlStatus, i6.NgControlStatusGroup, i6.NgModel, i6.FormGroupDirective, i6.FormControlName],\n      styles: [\".center-btn[_ngcontent-%COMP%]{display:flex;justify-content:center}\"]\n    });\n  }\n  return MonitoringComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}